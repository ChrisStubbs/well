<div class="table-container">
    <ol class="breadcrumb">
        <li class="active">Routes</li>
    </ol>
</div>
<div class="jumbotron">
    <div class="content">
        <div class="row">
            <div class="col-md-6">
               
            </div>
            <div class="col-md-6 pull-right">
                <div class="pull-right">
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" (click)="clearFilters()">Clear Filter</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12"> &nbsp;</div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <p-dataTable [value]="routes" [rows]="rowCount" [paginator]="true"
                             [pageLinks]="pageLinks" [rowsPerPageOptions]="rowsPerPageOptions"
                             #dt>
                    <p-column header="Branch" field="branchId" [sortable]="true" filter="true">
                        <ng-template pTemplate="filter" let-col>
                            <select class="form-control" id="searchBranch"
                                    (change)="dt.filter($event.target.value,col.field,col.filterMatchMode)"
                                    [ngModel]="routeFilter.branchId ? routeFilter.branchId.value : ''">
                                <option *ngFor="let branch of branches" [value]="branch[0] || '' ">
                                    {{ branch[1] }}
                                </option>
                            </select>
                        </ng-template>
                        <ng-template let-route="rowData" pTemplate="body">
                            <span>
                                {{route.branch}}
                            </span>
                        </ng-template>
                    </p-column>
                    <p-column header="Route" field="routeNumber" [sortable]="true" [filter]="true" >
                        <ng-template let-route="rowData" pTemplate="body">
                            <span>
                                <a routerLink="/singleroute/{{route.id}}" routerLinkActive="active">{{route.routeNumber}}</a>
                            </span>
                        </ng-template>
                    </p-column>
                    <p-column header="Date" field="routeDate" [sortable]="true" [style]="{'overflow':'visible','width':'150px'}" [filter]="true" filterMatchMode="contains">
                        <ng-template pTemplate="filter" let-col>
                            <ow-date (change)="dt.filter($event.target.value,col.field,col.filterMatchMode)"
                                     value="{{routeFilter.routeDate ? routeFilter.routeDate.value : '' }}">
                            </ow-date>
                        </ng-template>
                        <ng-template let-route="rowData" pTemplate="body">
                            <span>
                                {{route.routeDate | date:'dd/MM/yyyy' }}
                            </span>
                        </ng-template>
                    </p-column>
                    <p-column header="Stops" field="stopCount" [sortable]="true" [filter]="true"></p-column>
                    <p-column header="Status" field="routeStatusId" [sortable]="true" [filter]="true">
                        <ng-template pTemplate="filter" let-col>
                            <select class="form-control" id="searchStatus"
                                    (change)="dt.filter($event.target.value,col.field,col.filterMatchMode)"
                                    [ngModel]="routeFilter.routeStatusId ? routeFilter.routeStatusId.value : ''">
                                <option value>All</option>
                                <option *ngFor="let status of jobStatus" [value]="status.value">
                                    {{ status.value }}
                                </option>
                            </select>
                        </ng-template>
                        <ng-template let-route="rowData" pTemplate="body">
                            <span>
                                {{route.routeStatus}}
                            </span>
                        </ng-template>
                    </p-column>
                    <p-column header="Clean" field="cleanCount" [sortable]="true" [filter]="false"></p-column>
                    <p-column header="Exceptions" field="hasExceptions" [sortable]="true" [filter]="true">
                        <ng-template pTemplate="filter" let-col>
                            <select class="form-control" id="exceptionFilterCtl"
                                    [ngModel]="routeFilter.exception ? routeFilter.exception.value : ''"
                                    (change)="dt.filter($event.target.value,col.field,col.filterMatchMode)">
                                <option *ngFor="let exceptionFilterItem of exceptionFilterItems" [value]="exceptionFilterItem[0]">
                                    {{exceptionFilterItem[1]}}
                                </option>
                            </select>
                        </ng-template>

                        <ng-template let-route="rowData" pTemplate="body">
                            <span>
                                {{route.exceptionCount}}
                            </span>
                        </ng-template>

                    </p-column>
                    <p-column header="Driver" field="driverName" [sortable]="true" [filter]="true"></p-column>
                    <p-column header="Assignee" field="assignee" [sortable]="true" [filter]="true">
                        <ng-template let-route="rowData" pTemplate="body">
                            <assign-modal (onAssigned)="onAssigned($event)" [model]="getAssignModel(route)"></assign-modal>
                        </ng-template>
                    </p-column>
                </p-dataTable>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12"> &nbsp;</div>
        </div>
        <div class="row">
            <div class="col-md-6"><span class="pull-left">Last updated {{lastRefresh | date: 'medium'}}</span></div>
        </div>
    </div>
</div>